<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Home Page V1 Terminal</title>
  <link href="./app.css" rel="stylesheet"/>
</head>
<body>
<header class="dxtl-header">
  <img class="logo" src="logo.svg"/>
  <div class="status"><span class="pulse-dot"></span>Live Terminal</div>
</header>

<div class="app">
  <aside class="nav-rail">
    <div class="brand">
      <svg aria-hidden="true" class="brand-icon" viewBox="0 0 48 48">
        <defs>
          <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#60A5FA" />
            <stop offset="1" stop-color="#22D3EE" />
          </linearGradient>
        </defs>
        <circle cx="24" cy="24" r="20" fill="url(#g)" opacity=".25"></circle>
        <circle cx="24" cy="24" r="19" fill="none" stroke="url(#g)" stroke-width="2" opacity=".6"></circle>
        <polygon points="21,17 33,24 21,31" fill="url(#g)"></polygon>
      </svg>
      <span class="brand-text">XLT</span>
    </div>

    <nav class="nav-group">
      <button class="nav-btn" data-route="home"><span class="i">ğŸ </span><span class="t">Home</span></button>
      <button class="nav-btn" data-route="pulse"><span class="i">ğŸ“ˆ</span><span class="t">Pulse</span></button>
      <button class="nav-btn" data-route="dex"><span class="i">ğŸ”„</span><span class="t">Dex</span></button>
      <button class="nav-btn" data-route="wealth"><span class="i">ğŸ’¼</span><span class="t">Wealth</span></button>
      <button class="nav-btn active" data-route="bots"><span class="i">ğŸ¤–</span><span class="t">Bot Army</span></button>
      <button class="nav-btn" data-route="market"><span class="i">ğŸ›’</span><span class="t">Market Place</span></button>
      <button class="nav-btn" data-route="learn"><span class="i">ğŸ“</span><span class="t">Learn Zone</span></button>
    </nav>

    <div class="nav-spacer"></div>
    <nav class="nav-group">
      <button class="nav-btn" data-route="settings"><span class="i">âš™ï¸</span><span class="t">Settings</span></button>
      <button class="nav-btn" data-route="login"><span class="i">ğŸ”’</span><span class="t">User Login</span></button>
      <button class="nav-btn" data-route="mt"><span class="i">ğŸ“Š</span><span class="t">MT4/MT5 Account</span></button>
    </nav>
  </aside>

  <main class="main">
    <div class="topbar">
      <span class="badge left">Live Mode</span>
      <div class="topbar-title">Pulse</div>
      <div class="spacer"></div>
      <div class="wallet" id="wallet-open">
        <span>ğŸ‘›</span><strong id="wallet-status">Disconnected</strong>
      </div>
    </div>

    <div class="content pulse-wrap">
      <!-- Controls -->
      <section class="card pulse-controls">
        <div class="search-wrap">
          <span class="search-ico" title="Search asset">
            <svg viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
              <line x1="16.5" y1="16.5" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          <input id="pulseSearch" type="text" placeholder="Search asset (e.g., BTCUSDT)" list="suggestList"/>
          <datalist id="suggestList"></datalist>
          <button class="btn" id="pulseSet">Set</button>
        </div>
        <div class="now-playing">
          <button class="icon-btn" id="soundBtn" title="Toggle sound">
            <svg viewBox="0 0 24 24" class="ico-sound"><path d="M4 9h4l4-3v12l-4-3H4z" fill="currentColor"/><path d="M16 8a5 5 0 010 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <svg viewBox="0 0 24 24" class="ico-mute"><path d="M4 9h4l4-3v12l-4-3H4z" fill="currentColor"/><path d="M17 7l4 4m0-4l-4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </button>
          <span class="chip">Symbol: <strong id="pulseSymbol">â€”</strong></span>
          <span class="chip bpm">BPM: <strong id="pulseBpm">â€”</strong></span>
          <span class="chip">State: <strong id="pulseState">â€”</strong></span>
          <span class="chip">Price: <strong id="pdPrice">â€”</strong></span>
        </div>
      </section>

      <!-- Heart monitor -->
      <section class="card pulse-hero">
        <canvas id="pulseCanvas"></canvas>
        <div class="pulse-overlay"><div class="ecg-glow"></div></div>
      </section>

      <!-- Info panel -->
      <section class="card pulse-data">
        <header class="pd-head">
          <div class="pd-title">
            <div class="dot live"></div>
            <div>
              <h3 id="pdSymbol">â€”</h3>
              <div class="muted" id="pdSubtitle">Select an asset to load insights.</div>
            </div>
          </div>
          <div class="pd-badges">
            <span class="chip" id="pdTrend">Trend: â€”</span>
            <span class="chip" id="pdRegime">Regime: â€”</span>
            <span class="chip" id="pdRisk">Risk: â€”</span>
          </div>
        </header>

        <div class="pd-grid">
          <div class="pd-col">
            <div class="pd-card">
              <h4>About</h4>
              <p class="muted" id="pdAbout">â€”</p>
              <div class="meta">
                <span>Age: <strong id="pdAge">â€”</strong></span>
                <span>Exchange: <strong id="pdVenue">â€”</strong></span>
              </div>
            </div>

            <div class="pd-card">
              <h4>Runs</h4>
              <ul class="list">
                <li>Last Bull Run: <strong id="pdLastBull">â€”</strong></li>
                <li>Next Run ETA: <strong id="pdNextRun">â€”</strong></li>
              </ul>
            </div>

            <div class="pd-card">
              <h4>Signals</h4>
              <ul class="list">
                <li>General Trend: <strong id="pdGeneralTrend">â€”</strong></li>
                <li>Momentum: <strong id="pdMomentum">â€”</strong></li>
                <li>Volatility: <strong id="pdVol">â€”</strong></li>
              </ul>
            </div>
          </div>

          <div class="pd-col charts">
            <div class="mini-chart">
              <canvas id="sparkPrice"></canvas>
              <div class="mini-label">Price Spark</div>
            </div>
            <div class="mini-chart">
              <canvas id="sparkVol"></canvas>
              <div class="mini-label">Volatility Spark</div>
            </div>
            <div class="mini-chart wide">
              <canvas id="sparkTrend"></canvas>
              <div class="mini-label">Trend Slope</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Market Depth -->
      <section class="card depth-card" id="depthCard">
        <div class="mini-head">
          <span>Market Depth</span>
          <span class="mini-sub muted">Top 25 levels Â· live</span>
          <span id="depthVenue" class="mini-sub muted" style="margin-left:.5rem"></span>
        </div>
        <div class="gauge-row">
          <canvas id="depthGauge"></canvas>
          <div class="labels">
            <div class="bid">Bids <strong id="depthBid">â€”%</strong></div>
            <div class="ask">Asks <strong id="depthAsk">â€”%</strong></div>
          </div>
        </div>
        <canvas id="depthSpark" style="margin-top:.5rem;width:540px;max-width:100%;height:44px"></canvas>
      </section>
    </div>

    <!-- Positions & Liquidity -->
    <section class="card pulse-positions" id="positionsPanel">
      <div class="pp-head">
        <div class="title">Positions & Liquidity</div>
        <div class="segrow small" id="ppTf">
          <button class="seg on" data-min="5">5m</button>
          <button class="seg" data-min="15">15m</button>
          <button class="seg" data-min="60">1h</button>
        </div>
      </div>
      <div class="pp-grid">
        <div class="pp-col stats">
          <div class="gauge">
            <canvas id="ppGauge"></canvas>
            <div class="gauge-label">
              <div><span class="long">Long</span> <strong id="ppLong">â€”%</strong></div>
              <div><span class="short">Short</span> <strong id="ppShort">â€”%</strong></div>
              <div class="muted" id="ppBias">Bias: â€”</div>
            </div>
          </div>
        </div>
        <div class="pp-col zones">
          <div class="zone-card">
            <div class="zone-head">Nearest Liquidity â€” <span class="long">Long</span></div>
            <div class="heat-wrap">
              <canvas id="ppLongHeat"></canvas>
              <div class="heat-legend"><span class="muted">Below</span> <span id="ppLongPrice">â€”</span></div>
            </div>
          </div>
          <div class="zone-card">
            <div class="zone-head">Nearest Liquidity â€” <span class="short">Short</span></div>
            <div class="heat-wrap">
              <canvas id="ppShortHeat"></canvas>
              <div class="heat-legend"><span class="muted">Above</span> <span id="ppShortPrice">â€”</span></div>
            </div>
          </div>
        </div>
      </div>
      <div class="pp-foot muted">Source: CoinGecko market data Â· Timeframe: <span id="ppTfLabel">5m</span></div>
    </section>

    <!-- Top 20 -->
    <section class="card pulse-top" id="top20">
      <div class="top-head">
        <div class="title">Top 20 â€” Market</div>
        <div class="segrow small" id="topMode">
          <button class="seg on" data-mode="mcap">Mkt Cap</button>
          <button class="seg" data-mode="movers1h">Movers 1h</button>
          <button class="seg" data-mode="movers24h">Movers 24h</button>
        </div>
        <div class="hint muted">Click an asset to set it as the Pulse symbol.</div>
      </div>
      <div class="asset-grid" id="assetGrid"></div>
    </section>
  </main>
</div>

<div class="modal-backdrop" id="wallet-modal">
  <div class="modal">
    <span class="close-x" id="wallet-close">âœ•</span>
    <h4>Connect Wallet</h4>
    <p style="color:#94a3b8;margin:0 0 8px 0">Choose a wallet:</p>
    <div class="row">
      <button class="btn full" data-wallet="MetaMask">MetaMask</button>
      <button class="btn full" data-wallet="WalletConnect">WalletConnect</button>
    </div>
    <div class="row">
      <button class="btn" onclick="DXLT.disconnect()">Disconnect</button>
      <button class="btn primary" onclick="document.getElementById('wallet-close').click()">Close</button>
    </div>
  </div>
</div>

<footer>DXLT Neon v1.0</footer>

<script src="./feeds.js"></script>

<!-- Combined: routing + search suggestions + resolve + auto-apply -->
<script>
(() => {
  // ----- routing -----
  const routes = {
    home:'index.html', pulse:'pulse.html', dex:'dex.html', wealth:'wealth.html',
    bots:'bots.html', market:'market.html', learn:'learn.html',
    settings:'settings.html', login:'login.html', mt:'mt.html'
  };
  document.querySelectorAll('.nav-btn[data-route]').forEach(btn => {
    btn.addEventListener('click', () => {
      const r = btn.getAttribute('data-route');
      if (routes[r]) location.href = routes[r];
    });
  });

  // ----- search, suggestions, resolve, and APPLY -----
  const input = document.getElementById('pulseSearch');
  const list  = document.getElementById('suggestList');
  const setBtn= document.getElementById('pulseSet');
  const chip  = document.getElementById('pulseSymbol');

  async function applySymbol(raw) {
    const q = (raw || '').trim();
    if (!q) return;
    try {
      const r = await fetch(`/api/resolve?q=${encodeURIComponent(q)}&cb=${Date.now()}`, { cache:'no-store' });
      const j = await r.json();
      const sym = (j.symbol || q).toUpperCase();
      chip.textContent = sym;
      window.CURRENT = { ...(window.CURRENT||{}), symbol: sym };
      window.dispatchEvent(new CustomEvent('dxlt:set-symbol', { detail: { symbol: sym }}));
    } catch {
      const sym = q.toUpperCase();
      chip.textContent = sym;
      window.CURRENT = { ...(window.CURRENT||{}), symbol: sym };
      window.dispatchEvent(new CustomEvent('dxlt:set-symbol', { detail: { symbol: sym }}));
    }
  }

  let t = null;
  const debounce = (fn, ms=150) => { clearTimeout(t); t = setTimeout(fn, ms); };
  async function loadSuggestions(q='') {
    if (!list) return;
    try {
      const r = await fetch(`/api/symbols?q=${encodeURIComponent(q)}`, { cache:'no-store' });
      const j = await r.json();
      list.innerHTML = '';
      (j.items||[]).forEach(it => {
        const opt = document.createElement('option');
        opt.value = it.symbol;
        opt.label = `${it.base}/${it.quote} â€” ${it.venues.join('/')}`;
        opt.textContent = opt.label;
        list.appendChild(opt);
      });
    } catch {}
  }

  if (input) {
    input.addEventListener('input', () => debounce(() => loadSuggestions(input.value), 120));
    input.addEventListener('focus', () => { if (!list.options.length) loadSuggestions(''); });
    input.addEventListener('change', () => applySymbol(input.value));         // pick from datalist
    input.addEventListener('keydown', (e) => { if (e.key === 'Enter') applySymbol(input.value); });
  }
  if (setBtn) setBtn.addEventListener('click', () => applySymbol(input?.value || ''));
})();
</script>

<!-- PULSE LIVE (ECG + sparks) -->
<script>
/* ... your existing ECG/price/trend/vol script exactly as in your file ... */
</script>

<!-- Depth wiring (smart venue + tz + spark + gauge) -->
<script id="depth-wire">
/* ... your existing depth-wire exactly as in your file ... */
</script>

<!-- Positions & Liquidity wiring -->
<script id="positions-wire">
/* ... your existing positions-wire exactly as in your file ... */
</script>

<script src="./bots.js"></script>
<script src="./pulse.js"></script>
</body>
</html>
