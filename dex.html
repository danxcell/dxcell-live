<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DXLT ¬∑ Dex</title>
  <link href="./app.css" rel="stylesheet"/>
  <style>
    /* tiny page-scoped helpers only; everything else uses app.css */
    .dex-wrap{padding:12px;display:grid;gap:14px}
    .dex-controls{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .dex-controls .search-wrap{display:flex;align-items:center;gap:8px;background:#0b1220;border:1px solid #1f2a44;border-radius:14px;padding:8px 10px;min-width:420px;box-shadow:inset 0 0 0 1px rgba(31,42,68,.35)}
    .dex-controls .search-wrap input{background:transparent;border:none;outline:none;color:#e2e8f0;width:280px;font-size:14px}
    .dex-controls .segrow{display:flex;gap:8px;flex-wrap:wrap}
    .dex-controls .seg.on{background:linear-gradient(90deg,#22d3ee,#60a5fa);color:#081426;border:none}

    .dex-grid{display:grid;grid-template-columns:1.6fr 1fr;gap:14px}
    @media (max-width:1100px){ .dex-grid{grid-template-columns:1fr} }

    /* chart card */
    #dexChart{width:100%;min-height:540px;border:0;border-radius:12px;display:block;overflow:hidden}
    .dex-chart-card{padding:0;overflow:hidden}
    .dex-chart-head{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid rgba(96,165,250,.15)}
    .venue-links{display:flex;gap:8px;flex-wrap:wrap}
    .venue-links .btn{height:32px;line-height:32px;padding:0 10px;border-radius:10px}

    /* pair facts */
    .facts{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:12px}
    @media (max-width:480px){ .facts{grid-template-columns:1fr} }
    .fact{background:#0b1220;border:1px solid #1f2a44;border-radius:12px;padding:10px}
    .fact .k{color:#94a3b8;font-size:12px;margin-bottom:6px}
    .fact .v{font-weight:800}

    /* movers */
    .movers-card{padding:14px}
    .movers-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
    .mover{position:relative;background:#0b1220;border:1px solid #1f2a44;border-radius:14px;padding:10px;display:flex;gap:10px;cursor:pointer;transition:transform .15s ease, border-color .15s ease, box-shadow .15s}
    .mover:hover{transform:translateY(-2px);border-color:#2a3b66;box-shadow:0 10px 26px rgba(34,211,238,.08)}
    .m-logo{width:28px;height:28px;border-radius:50%;overflow:hidden;flex:0 0 auto;box-shadow:0 0 0 1px #1f2a44}
    .m-meta{display:flex;flex-direction:column;gap:2px}
    .m-name{font-weight:700}
    .m-sub{font-size:12px;color:#94a3b8}
    .m-right{margin-left:auto;text-align:right}
    .m-chg{font-weight:800}
    .m-chg.pos{color:#22c55e}.m-chg.neg{color:#ef4444}
    .m-liq{font-size:12px;color:#94a3b8}
    .m-badge{position:absolute;right:8px;top:8px;font-size:11px;color:#60a5fa}
  </style>
</head>
<body>
<header class="dxtl-header">
  <img class="logo" src="logo.svg" alt="DXLT"/>
  <div class="status"><span class="pulse-dot"></span>Live Mode</div>
</header>

<div class="app">
  <!-- Rail -->
  <aside class="nav-rail">
    <div class="brand">
      <svg aria-hidden="true" class="brand-icon" viewBox="0 0 48 48">
        <defs>
          <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#60A5FA" />
            <stop offset="1" stop-color="#22D3EE" />
          </linearGradient>
        </defs>
        <circle cx="24" cy="24" r="20" fill="url(#g)" opacity=".25"></circle>
        <circle cx="24" cy="24" r="19" fill="none" stroke="url(#g)" stroke-width="2" opacity=".6"></circle>
        <polygon points="21,17 33,24 21,31" fill="url(#g)"></polygon>
      </svg>
      <span class="brand-text">XLT</span>
    </div>

    <nav class="nav-group">
      <button class="nav-btn" data-route="home"><span class="i">üè†</span><span class="t">Home</span></button>
      <button class="nav-btn active" data-route="dex"><span class="i">üîÑ</span><span class="t">Dex</span></button>
      <button class="nav-btn" data-route="pulse"><span class="i">üìà</span><span class="t">Pulse</span></button>
      <button class="nav-btn" data-route="wealth"><span class="i">üíº</span><span class="t">Wealth</span></button>
      <button class="nav-btn" data-route="bots"><span class="i">ü§ñ</span><span class="t">Bot Army</span></button>
      <button class="nav-btn" data-route="market"><span class="i">üõí</span><span class="t">Market Place</span></button>
      <button class="nav-btn" data-route="learn"><span class="i">üéì</span><span class="t">Learn Zone</span></button>
    </nav>

    <div class="nav-spacer"></div>
    <nav class="nav-group">
      <button class="nav-btn" data-route="settings"><span class="i">‚öôÔ∏è</span><span class="t">Settings</span></button>
      <button class="nav-btn" data-route="login"><span class="i">üîí</span><span class="t">User Login</span></button>
      <button class="nav-btn" data-route="mt"><span class="i">üìä</span><span class="t">MT4/MT5 Account</span></button>
    </nav>
  </aside>

  <main class="main">
    <!-- Topbar -->
    <div class="topbar">
      <span class="badge left">Live Mode</span>
      <div class="topbar-title">Dex</div>
      <div class="spacer"></div>
      <div class="wallet" id="wallet-open">
        <span>üëõ</span><strong id="wallet-status">Disconnected</strong>
      </div>
    </div>

    <div class="content dex-wrap">
      <!-- Controls -->
      <section class="card dex-controls">
        <div class="search-wrap">
          <span class="search-ico" title="Search token/pair">
            <svg viewBox="0 0 24 24" width="18" height="18">
              <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
              <line x1="16.5" y1="16.5" x2="21" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          <input id="dexSearch" type="text" placeholder="Paste token address, pair URL, or type symbol‚Ä¶"/>
          <button class="btn" id="dexGo">Go</button>
        </div>
        <div class="segrow" id="dexChains">
          <button class="seg on" data-chain="all">All</button>
          <button class="seg" data-chain="ethereum">Ethereum</button>
          <button class="seg" data-chain="bsc">BSC</button>
          <button class="seg" data-chain="base">Base</button>
          <button class="seg" data-chain="arbitrum">Arbitrum</button>
          <button class="seg" data-chain="optimism">Optimism</button>
          <button class="seg" data-chain="polygon">Polygon</button>
          <button class="seg" data-chain="solana">Solana</button>
        </div>
      </section>

      <!-- Chart + Pair summary -->
      <section class="dex-grid">
        <div class="card dex-chart-card">
          <div class="dex-chart-head">
            <div class="title" id="dexPairTitle">Select a pair</div>
            <div class="venue-links" id="venueLinks"></div>
          </div>
          <iframe id="dexChart" title="Dexscreener Chart" loading="lazy"
                  src="about:blank" allow="clipboard-write *"></iframe>
        </div>

        <div class="card">
          <header class="card-head">
            <div class="title">Pair Facts</div>
            <div class="muted" id="dexPairSub">‚Äî</div>
          </header>
          <div class="facts">
            <div class="fact"><div class="k">Price</div><div class="v" id="fPrice">‚Äî</div></div>
            <div class="fact"><div class="k">24h Change</div><div class="v" id="fChg">‚Äî</div></div>
            <div class="fact"><div class="k">Liquidity</div><div class="v" id="fLiq">‚Äî</div></div>
            <div class="fact"><div class="k">FDV</div><div class="v" id="fFdv">‚Äî</div></div>
            <div class="fact"><div class="k">24h Volume</div><div class="v" id="fVol">‚Äî</div></div>
            <div class="fact"><div class="k">Txns (5m)</div><div class="v" id="fTx">‚Äî</div></div>
          </div>
        </div>
      </section>

      <!-- Movers -->
      <section class="card movers-card">
        <div class="top-head" style="display:flex;justify-content:space-between;align-items:center">
          <div class="title">Top Movers ‚Äî Multi-Chain (Dexscreener)</div>
          <div class="hint muted">Click a tile to load the chart. Filters respect the chain chips above.</div>
        </div>
        <div class="movers-grid" id="moversGrid"></div>
      </section>
    </div>
  </main>
</div>

<footer>DXLT Neon v1.0</footer>

<script>
/* routes */
(() => {
  const routes = {
    home:'index.html', pulse:'pulse.html', dex:'dex.html', wealth:'wealth.html',
    bots:'bots.html', market:'market.html', learn:'learn.html',
    settings:'settings.html', login:'login.html', mt:'mt.html'
  };
  document.querySelectorAll('.nav-btn[data-route]').forEach(btn => {
    btn.addEventListener('click', () => {
      const r = btn.getAttribute('data-route');
      if (routes[r]) window.location.href = routes[r];
    });
  });
})();

/* DEX logic (Dexscreener API + embed) */
(() => {
  const $ = s => document.querySelector(s);
  const moversGrid = $('#moversGrid');
  const chart = $('#dexChart');
  const title = $('#dexPairTitle');
  const sub   = $('#dexPairSub');
  const venueLinks = $('#venueLinks');
  const chainsBar = $('#dexChains');
  const input = $('#dexSearch');
  const goBtn = $('#dexGo');

  const facts = {
    price: $('#fPrice'),
    chg:   $('#fChg'),
    liq:   $('#fLiq'),
    fdv:   $('#fFdv'),
    vol:   $('#fVol'),
    tx:    $('#fTx'),
  };

  const S = { chainFilter: 'all', selected: null, movers: [] };

  const fmtMoney = (n) => {
    if (n == null || !isFinite(n)) return '‚Äî';
    const v = Number(n);
    if (v >= 1e9) return '$' + (v/1e9).toFixed(2) + 'b';
    if (v >= 1e6) return '$' + (v/1e6).toFixed(2) + 'm';
    if (v >= 1e3) return '$' + (v/1e3).toFixed(2) + 'k';
    return '$' + v.toLocaleString(undefined,{maximumFractionDigits:2});
  };
  const fmtNum = (n, dp=2) => (n==null||!isFinite(n))?'‚Äî':Number(n).toLocaleString(undefined,{maximumFractionDigits:dp});
  const signChg = (x) => (x>0?'+':'') + (Number(x)||0).toFixed(2) + '%';

  function embedPair(p){
    if (!p) return;
    const src = `https://dexscreener.com/${p.chainId}/${p.pairAddress}?embed=1&theme=dark&trades=0`;
    chart.src = src;
    title.textContent = `${p.baseToken?.symbol||'‚Äî'}/${p.quoteToken?.symbol||'‚Äî'} ‚Ä¢ ${p.chainId}`;
    sub.textContent   = p.pairAddress;

    facts.price.textContent = p.priceUsd ? ('$' + Number(p.priceUsd).toFixed(6)) : '‚Äî';
    facts.chg.textContent   = p.priceChange?.h24!=null ? signChg(p.priceChange.h24) : '‚Äî';
    facts.chg.className = 'v ' + ((p.priceChange?.h24||0) >= 0 ? 'up' : 'down');
    facts.liq.textContent   = fmtMoney(p.liquidity?.usd);
    facts.fdv.textContent   = fmtMoney(p.fdv);
    facts.vol.textContent   = fmtMoney(p.volume?.h24);
    const txns = Number(p.txns?.m5?.buys||0)+Number(p.txns?.m5?.sells||0);
    facts.tx.textContent    = fmtNum(txns,0);

    renderVenues(p);
    S.selected = p;
  }

  function renderVenues(p){
    const links = [];
    // token/routers per chain
    const map = {
      ethereum: [{name:'Uniswap', base:'https://app.uniswap.org/explore/tokens/ethereum/', type:'token'}],
      base:     [{name:'Uniswap', base:'https://app.uniswap.org/explore/tokens/base/', type:'token'}],
      arbitrum: [{name:'Uniswap', base:'https://app.uniswap.org/explore/tokens/arbitrum/', type:'token'},
                 {name:'Sushi',   base:'https://www.sushi.com/swap?chainId=42161&tokenIn=', type:'swap'}],
      optimism: [{name:'Uniswap', base:'https://app.uniswap.org/explore/tokens/optimism/', type:'token'}],
      polygon:  [{name:'QuickSwap', base:'https://quickswap.exchange/#/swap?currency0=', type:'swap'}],
      bsc:      [{name:'Pancake', base:'https://pancakeswap.finance/swap?outputCurrency=', type:'swap'}],
      solana:   [{name:'Jupiter', base:'https://jup.ag/swap/', type:'sol'}],
    };

    const chain = p.chainId;
    const baseAddr  = p.baseToken?.address;
    const quoteAddr = p.quoteToken?.address;

    (map[chain]||[]).forEach(v=>{
      let href = '#';
      if (v.type==='token' && baseAddr){
        href = v.base + baseAddr;
      } else if (v.type==='swap'){
        if (chain==='polygon' && baseAddr){
          href = v.base + baseAddr;
        } else if (chain==='bsc' && baseAddr){
          href = v.base + baseAddr;
        } else if (chain==='arbitrum' && baseAddr && quoteAddr){
          href = `${v.base}${quoteAddr}&tokenOut=${baseAddr}`;
        }
      } else if (v.type==='sol'){
        // solana pairs on Jupiter: try token symbol if no address
        const t = p.baseToken?.address || p.baseToken?.symbol || '';
        href = v.base + encodeURIComponent(t);
      }
      links.push(`<a class="btn" target="_blank" rel="noopener noreferrer" href="${href}">${v.name}</a>`);
    });

    // always include dexscreener page
    links.push(`<a class="btn" target="_blank" rel="noopener noreferrer" href="https://dexscreener.com/${chain}/${p.pairAddress}">Dexscreener</a>`);
    venueLinks.innerHTML = links.join('');
  }

  async function searchDex(q){
    // Dexscreener search covers symbols, addresses, pair links
    // https://api.dexscreener.com/latest/dex/search?q=...
    const url = `https://api.dexscreener.com/latest/dex/search?q=${encodeURIComponent(q)}`;
    const r = await fetch(url, { cache:'no-store' });
    if (!r.ok) throw new Error('dexsearch '+r.status);
    const j = await r.json();
    return (j.pairs||[]);
  }

  async function loadTrending(){
    try{
      const pairs = await searchDex('trending');
      S.movers = pairs;
      renderMovers();
      // pick the first reasonable EVM pair for the chart
      const pick = pairs.find(p => p.chainId && p.pairAddress);
      if (pick) embedPair(pick);
    }catch(e){
      console.warn('trending error', e);
      moversGrid.innerHTML = `<div class="placeholder">Unable to load movers. Try searching a token.</div>`;
    }
  }

  function chainPass(p){
    if (S.chainFilter==='all') return true;
    return (String(p.chainId||'').toLowerCase() === S.chainFilter.toLowerCase());
  }

  function renderMovers(){
    const list = (S.movers||[]).filter(chainPass).slice(0, 24);
    if (!list.length){
      moversGrid.innerHTML = `<div class="placeholder">No results for this chain filter.</div>`;
      return;
    }
    moversGrid.innerHTML = list.map(p=>{
      const chg = p.priceChange?.h24 ?? 0;
      const logo = p.info?.imageUrl || p.baseToken?.logoURI || '';
      return `
      <div class="mover" data-chain="${p.chainId}" data-pair="${p.pairAddress}">
        <img class="m-logo" src="${logo||'https://assets.dexscreener.com/favicon.png'}" alt="">
        <div class="m-meta">
          <div class="m-name">${(p.baseToken?.symbol||'‚Äî')}/${(p.quoteToken?.symbol||'‚Äî')}</div>
          <div class="m-sub">${p.chainId}</div>
        </div>
        <div class="m-right">
          <div class="m-chg ${chg>=0?'pos':'neg'}">${signChg(chg)}</div>
          <div class="m-liq">${fmtMoney(p.liquidity?.usd)} liq</div>
        </div>
        <div class="m-badge">${p.dexId || ''}</div>
      </div>`;
    }).join('');
  }

  // events
  moversGrid.addEventListener('click', e=>{
    const card = e.target.closest('.mover');
    if (!card) return;
    const chain = card.getAttribute('data-chain');
    const pair  = card.getAttribute('data-pair');
    const p = (S.movers||[]).find(x=>x.chainId===chain && x.pairAddress===pair);
    if (p) embedPair(p);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  chainsBar.addEventListener('click', e=>{
    const b = e.target.closest('button.seg'); if (!b) return;
    chainsBar.querySelectorAll('.seg').forEach(x=>x.classList.toggle('on', x===b));
    S.chainFilter = b.dataset.chain || 'all';
    renderMovers();
  });

  async function handleGo(){
    const q = input.value.trim();
    if (!q) return;
    try{
      const res = await searchDex(q);
      if (!res.length){
        title.textContent = 'No results';
        chart.src = 'about:blank';
        return;
      }
      // prefer the first result that matches current chain filter
      const pick = res.find(chainPass) || res[0];
      embedPair(pick);
      // also show these as movers (contextual results)
      S.movers = res;
      renderMovers();
    }catch(e){
      console.warn('search error', e);
    }
  }
  goBtn.addEventListener('click', handleGo);
  input.addEventListener('keydown', e=>{ if(e.key==='Enter') handleGo(); });

  document.addEventListener('DOMContentLoaded', loadTrending);
})();
</script>
</body>
</html>
