<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>DXLT Â· DEX</title>
  <link href="./app.css" rel="stylesheet"/>
</head>
<body>
<header class="dxtl-header">
  <img class="logo" src="logo.svg" alt="DXLT"/>
  <div class="status"><span class="pulse-dot"></span>Live Mode</div>
</header>

<div class="app">
  <!-- Rail -->
  <aside class="nav-rail">
    <div class="brand">
      <svg aria-hidden="true" class="brand-icon" viewBox="0 0 48 48">
        <defs>
          <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#60A5FA" />
            <stop offset="1" stop-color="#22D3EE" />
          </linearGradient>
        </defs>
        <circle cx="24" cy="24" r="20" fill="url(#g)" opacity=".25"></circle>
        <circle cx="24" cy="24" r="19" fill="none" stroke="url(#g)" stroke-width="2" opacity=".6"></circle>
        <polygon points="21,17 33,24 21,31" fill="url(#g)"></polygon>
      </svg>
      <span class="brand-text">XLT</span>
    </div>

    <nav class="nav-group">
      <button class="nav-btn" data-route="home"><span class="i">ğŸ </span><span class="t">Home</span></button>
      <button class="nav-btn active" data-route="dex"><span class="i">ğŸ”„</span><span class="t">Dex</span></button>
      <button class="nav-btn" data-route="pulse"><span class="i">ğŸ“ˆ</span><span class="t">Pulse</span></button>
      <button class="nav-btn" data-route="wealth"><span class="i">ğŸ’¼</span><span class="t">Wealth</span></button>
      <button class="nav-btn" data-route="bots"><span class="i">ğŸ¤–</span><span class="t">Bot Army</span></button>
      <button class="nav-btn" data-route="market"><span class="i">ğŸ›’</span><span class="t">Market Place</span></button>
      <button class="nav-btn" data-route="learn"><span class="i">ğŸ“</span><span class="t">Learn Zone</span></button>
    </nav>

    <div class="nav-spacer"></div>
    <nav class="nav-group">
      <button class="nav-btn" data-route="settings"><span class="i">âš™ï¸</span><span class="t">Settings</span></button>
      <button class="nav-btn" data-route="login"><span class="i">ğŸ”’</span><span class="t">User Login</span></button>
      <button class="nav-btn" data-route="mt"><span class="i">ğŸ“Š</span><span class="t">MT4/MT5 Account</span></button>
    </nav>
  </aside>

  <main class="main">
    <!-- Topbar -->
    <div class="topbar">
      <span class="badge left">Live Mode</span>
      <div class="topbar-title">DEX</div>
      <div class="spacer"></div>
      <div class="wallet" id="wallet-open">
        <span>ğŸ‘›</span><strong id="wallet-status">Disconnected</strong>
      </div>
    </div>

    <div class="content dex-wrap">
      <!-- SCOUT / FILTERS -->
      <section class="card">
        <header class="card-head">
          <div class="title">Scout</div>
          <div class="muted">Multi-chain filters powered by Dexscreener</div>
        </header>

        <div class="dex-controls">
          <!-- Chains -->
          <div class="segrow" id="dxChains">
            <button class="seg on" data-chain="">All</button>
            <button class="seg" data-chain="solana">Solana</button>
            <button class="seg" data-chain="ethereum">Ethereum</button>
            <button class="seg" data-chain="bsc">BSC</button>
            <button class="seg" data-chain="base">Base</button>
            <button class="seg" data-chain="arbitrum">Arbitrum</button>
            <button class="seg" data-chain="optimism">Optimism</button>
            <button class="seg" data-chain="polygon">Polygon</button>
          </div>

          <!-- Quick filters -->
          <div class="segrow" id="dxQuick">
            <button class="seg on" data-qf="all">All</button>
            <button class="seg" data-qf="gainers">Gainers</button>
            <button class="seg" data-qf="losers">Losers</button>
            <button class="seg" data-qf="new">New &lt; 24h</button>
            <button class="seg" data-qf="hot">Hot TXNs</button>
          </div>

          <!-- Thresholds + search -->
          <div class="dx-thresholds">
            <label>Vol (24h) â‰¥
              <select id="dxVol">
                <option value="0">$0</option>
                <option value="10000">$10k</option>
                <option value="50000">$50k</option>
                <option value="100000" selected>$100k</option>
                <option value="250000">$250k</option>
                <option value="1000000">$1M</option>
              </select>
            </label>

            <label>Liquidity â‰¥
              <select id="dxLiq">
                <option value="0">$0</option>
                <option value="50000">$50k</option>
                <option value="100000" selected>$100k</option>
                <option value="250000">$250k</option>
                <option value="1000000">$1M</option>
              </select>
            </label>

            <label>Sort by
              <select id="dxSort">
                <option value="volume24">Vol 24h</option>
                <option value="chg24">Change 24h</option>
                <option value="liquidity">Liquidity</option>
                <option value="age">Age</option>
                <option value="txns24">TXNs 24h</option>
              </select>
            </label>

            <div class="spacer"></div>

            <div class="dx-search">
              <input id="dxSearch" placeholder="Search token / address / pair URLâ€¦"/>
              <button class="btn" id="dxGo">Go</button>
            </div>
          </div>
        </div>
      </section>

      <!-- CHART + FACTS -->
      <section class="grid-2">
        <div class="card dex-chart">
          <div class="card-head">
            <div class="title" id="dxPairTitle">Select a pair</div>
            <div class="venue-links" id="venueLinks"></div>
          </div>
          <iframe id="dxChart" title="Dexscreener Chart" loading="lazy" src="about:blank" allow="clipboard-write *"></iframe>
        </div>

        <div class="card">
          <header class="card-head">
            <div class="title">Pair Facts</div>
            <div class="muted" id="dxPairSub">â€”</div>
          </header>
          <div class="facts">
            <div class="fact"><div class="k">Price</div><div class="v" id="fPrice">â€”</div></div>
            <div class="fact"><div class="k">24h Change</div><div class="v" id="fChg">â€”</div></div>
            <div class="fact"><div class="k">Liquidity</div><div class="v" id="fLiq">â€”</div></div>
            <div class="fact"><div class="k">FDV</div><div class="v" id="fFdv">â€”</div></div>
            <div class="fact"><div class="k">Vol 24h</div><div class="v" id="fVol">â€”</div></div>
            <div class="fact"><div class="k">TXNs (5m)</div><div class="v" id="fTx">â€”</div></div>
          </div>
        </div>
      </section>

      <!-- TABLE VIEW (scannable like your red boxes) -->
      <section class="card">
        <header class="card-head">
          <div class="title">Pairs</div>
          <div class="muted" id="dxMeta">â€”</div>
        </header>
        <div class="table">
          <div class="tr head dx-grid">
            <div>#</div><div>Chain</div><div>Pair</div><div>Price</div>
            <div>Age</div><div>TXNs 24h</div><div>Vol 24h</div><div>Liq</div>
            <div>1h</div><div>6h</div><div>24h</div>
          </div>
          <div id="dxBody"></div>
        </div>
      </section>
    </div>
  </main>
</div>

<footer>DXLT Neon v1.0</footer>

<!-- Routes -->
<script>
(() => {
  const routes = {
    home:'index.html', pulse:'pulse.html', dex:'dex.html', wealth:'wealth.html',
    bots:'bots.html', market:'market.html', learn:'learn.html',
    settings:'settings.html', login:'login.html', mt:'mt.html'
  };
  document.querySelectorAll('.nav-btn[data-route]').forEach(btn => {
    btn.addEventListener('click', () => {
      const r = btn.getAttribute('data-route');
      if (routes[r]) window.location.href = routes[r];
    });
  });
})();
</script>

<!-- DEX logic -->
<script>
(() => {
  // ------- Elements
  const el = id => document.getElementById(id);
  const dxChains = el('dxChains');
  const dxQuick  = el('dxQuick');
  const dxVol    = el('dxVol');
  const dxLiq    = el('dxLiq');
  const dxSort   = el('dxSort');
  const dxSearch = el('dxSearch');
  const dxGo     = el('dxGo');
  const dxMeta   = el('dxMeta');
  const dxBody   = el('dxBody');
  const chart    = el('dxChart');
  const title    = el('dxPairTitle');
  const sub      = el('dxPairSub');
  const venues   = el('venueLinks');

  const facts = {
    price: el('fPrice'), chg: el('fChg'), liq: el('fLiq'),
    fdv: el('fFdv'), vol: el('fVol'), tx: el('fTx')
  };

  // ------- State
  const S = {
    chain: '',         // '', 'solana', 'ethereum', ...
    quick: 'all',      // all|gainers|losers|new|hot
    volMin: 100000,    // USD
    liqMin: 100000,    // USD
    sort: 'volume24',  // volume24|chg24|liquidity|age|txns24
    q: ''
  };

  // ------- Utils
  const fmtMoney = (n) => {
    if (n==null || !isFinite(n)) return 'â€”';
    const v = Number(n);
    if (v>=1e9) return '$'+(v/1e9).toFixed(2)+'b';
    if (v>=1e6) return '$'+(v/1e6).toFixed(2)+'m';
    if (v>=1e3) return '$'+(v/1e3).toFixed(1)+'k';
    return '$'+v.toLocaleString();
  };
  const fmtNum = (n,dp=2)=> (n==null||!isFinite(n))?'â€”':Number(n).toLocaleString(undefined,{maximumFractionDigits:dp});
  const signChg = (x)=> (x>0?'+':'') + (Number(x)||0).toFixed(2) + '%';
  const ageFrom = ts => {
    if(!ts) return {label:'â€”',hours:9e9};
    const h = (Date.now()-ts)/36e5;
    if (h<24) return {label:Math.max(1,Math.floor(h))+'h', hours:h};
    const d = Math.floor(h/24); return {label:d+'d', hours:h};
  };

  // ------- API
  async function searchDex(q){
    const url = `https://api.dexscreener.com/latest/dex/search?q=${encodeURIComponent(q)}`;
    const r = await fetch(url, { cache:'no-store' });
    if (!r.ok) throw new Error('dex '+r.status);
    const j = await r.json();
    return Array.isArray(j.pairs)? j.pairs : [];
  }

  async function fetchPairs(){
    const terms = [];
    if (S.chain) terms.push(`chain:${S.chain}`);
    if (S.q)     terms.push(S.q);
    const q = terms.join(' ').trim() || (S.chain ? `chain:${S.chain}` : 'trending');
    const pairs = await searchDex(q);
    return S.chain ? pairs.filter(p => (p.chainId||'').toLowerCase()===S.chain) : pairs;
  }

  // ------- Render
  function embedPair(p){
    if (!p) return;
    chart.src = `https://dexscreener.com/${p.chainId}/${p.pairAddress}?embed=1&theme=dark&trades=0`;
    title.textContent = `${p.baseToken?.symbol||'â€”'}/${p.quoteToken?.symbol||'â€”'} â€¢ ${p.chainId}`;
    sub.textContent   = p.pairAddress;
    facts.price.textContent = p.priceUsd ? ('$'+Number(p.priceUsd).toFixed(6)) : 'â€”';
    const ch = p.priceChange?.h24 ?? 0; facts.chg.textContent = signChg(ch);
    facts.chg.className = 'v ' + (ch>=0?'up':'down');
    facts.liq.textContent = fmtMoney(p.liquidity?.usd);
    facts.fdv.textContent = fmtMoney(p.fdv);
    facts.vol.textContent = fmtMoney(p.volume?.h24);
    const t5 = (p.txns?.m5?.buys||0)+(p.txns?.m5?.sells||0);
    facts.tx.textContent = fmtNum(t5,0);
    renderVenueLinks(p);
  }

  function renderVenueLinks(p){
    const map = {
      ethereum:[{n:'Uniswap',t:'token',base:'https://app.uniswap.org/explore/tokens/ethereum/'}],
      base:[{n:'Uniswap',t:'token',base:'https://app.uniswap.org/explore/tokens/base/'}],
      arbitrum:[{n:'Uniswap',t:'token',base:'https://app.uniswap.org/explore/tokens/arbitrum/'}],
      optimism:[{n:'Uniswap',t:'token',base:'https://app.uniswap.org/explore/tokens/optimism/'}],
      polygon:[{n:'QuickSwap',t:'swap',base:'https://quickswap.exchange/#/swap?currency0='}],
      bsc:[{n:'Pancake',t:'swap',base:'https://pancakeswap.finance/swap?outputCurrency='}],
      solana:[{n:'Jupiter',t:'sol',base:'https://jup.ag/swap/'}]
    };
    const chain = p.chainId;
    const bt = p.baseToken?.address || p.baseToken?.symbol || '';
    const qt = p.quoteToken?.address || '';
    const links = [];
    (map[chain]||[]).forEach(v=>{
      let href = '#';
      if (v.t==='token') href = v.base + bt;
      else if (v.t==='swap') href = v.base + bt;
      else if (v.t==='sol') href = v.base + encodeURIComponent(bt);
      links.push(`<a class="btn" target="_blank" rel="noopener" href="${href}">${v.n}</a>`);
    });
    links.push(`<a class="btn" target="_blank" rel="noopener" href="https://dexscreener.com/${chain}/${p.pairAddress}">Dexscreener</a>`);
    venues.innerHTML = links.join('');
  }

  function rowHTML(x, i){
    const p=x.raw;
    const icon = p.info?.imageUrl || p.baseToken?.logo || '';
    const pair = `${p.baseToken?.symbol||'?'} / ${p.quoteToken?.symbol||'?'}`;
    const price = p.priceUsd ?? p.price ?? p.priceNative;
    const link = p.url || `https://dexscreener.com/${p.chainId}/${p.pairAddress}`;
    return `
      <div class="dx-row">
        <div>${i+1}</div>
        <div><span class="tag">${p.chainId?.toUpperCase?.()||p.chainId||'â€”'}</span></div>
        <div class="pair">${icon?`<img src="${icon}" alt="">`:''}<a target="_blank" rel="noopener" href="${link}">${pair}</a></div>
        <div>$${fmtNum(price,6)}</div>
        <div>${x.age.label}</div>
        <div>${fmtNum(x.tx24,0)}</div>
        <div>$${fmtNum(x.vol24,0)}</div>
        <div>$${fmtNum(x.liq,0)}</div>
        <div class="${x.chg1>=0?'good':'bad'}">${fmtNum(x.chg1,2)}%</div>
        <div class="${x.chg6>=0?'good':'bad'}">${fmtNum(x.chg6,2)}%</div>
        <div class="${x.chg24>=0?'good':'bad'}">${fmtNum(x.chg24,2)}%</div>
      </div>`;
  }

  function applyFilters(pairs){
    return pairs
      .map(p=>{
        const liq = p.liquidity?.usd ?? 0;
        const vol24 = p.volume?.h24 ?? 0;
        const tx24 = p.txns?.h24 ?? 0;
        const ch1 = p.priceChange?.h1 ?? 0;
        const ch6 = p.priceChange?.h6 ?? 0;
        const ch24 = p.priceChange?.h24 ?? 0;
        const age = ageFrom(p.pairCreatedAt);
        return { raw:p, liq, vol24, tx24, chg1:ch1, chg6:ch6, chg24:ch24, age };
      })
      .filter(x => x.vol24 >= S.volMin && x.liq >= S.liqMin)
      .filter(x => {
        switch(S.quick){
          case 'gainers': return x.chg24 >= 0;
          case 'losers' : return x.chg24 <  0;
          case 'new'    : return x.age.hours < 24;
          case 'hot'    : return x.tx24 >= 1000;
          default       : return true;
        }
      })
      .sort((a,b)=>{
        switch(S.sort){
          case 'chg24'   : return (b.chg24||-1)-(a.chg24||-1);
          case 'liquidity':return (b.liq||0)-(a.liq||0);
          case 'age'     : return (a.age.hours||9e9)-(b.age.hours||9e9);
          case 'txns24'  : return (b.tx24||0)-(a.tx24||0);
          default        : return (b.vol24||0)-(a.vol24||0);
        }
      });
  }

  async function fetchAndRender(){
    dxMeta.textContent = 'Loadingâ€¦';
    try{
      const pairs = await fetchPairs();
      const out = applyFilters(pairs);
      dxBody.innerHTML = out.slice(0,200).map(rowHTML).join('');
      dxMeta.textContent = `${out.length.toLocaleString()} matches Â· ${S.chain||'All chains'} Â· Vol â‰¥ $${S.volMin.toLocaleString()} Â· Liq â‰¥ $${S.liqMin.toLocaleString()}`;
      if (out.length && chart.src==='about:blank') embedPair(out[0].raw);
    }catch(e){
      console.warn(e);
      dxMeta.textContent = 'Error loading data';
      dxBody.innerHTML = '';
    }
  }

  // ------- Events
  dxChains.addEventListener('click', e=>{
    const b=e.target.closest('.seg'); if(!b) return;
    dxChains.querySelectorAll('.seg').forEach(x=>x.classList.toggle('on',x===b));
    S.chain = b.dataset.chain || '';
    fetchAndRender();
  });
  dxQuick.addEventListener('click', e=>{
    const b=e.target.closest('.seg'); if(!b) return;
    dxQuick.querySelectorAll('.seg').forEach(x=>x.classList.toggle('on',x===b));
    S.quick = b.dataset.qf || 'all';
    fetchAndRender();
  });
  dxVol.addEventListener('change', ()=>{ S.volMin=+dxVol.value; fetchAndRender(); });
  dxLiq.addEventListener('change', ()=>{ S.liqMin=+dxLiq.value; fetchAndRender(); });
  dxSort.addEventListener('change', ()=>{ S.sort=dxSort.value; fetchAndRender(); });
  dxGo.addEventListener('click', ()=>{ S.q = dxSearch.value.trim(); fetchAndRender(); });
  dxSearch.addEventListener('keydown', e=>{ if(e.key==='Enter'){ S.q = dxSearch.value.trim(); fetchAndRender(); } });

  document.addEventListener('DOMContentLoaded', fetchAndRender);
})();
</script>
</body>
</html>
